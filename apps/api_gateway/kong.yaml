_format_version: "3.0"
_transform: true

services:
  - name: auth-valid-service
    protocol: http
    host: host.docker.internal
    port: 5001
    routes:
      - name: auth-routes
        paths:
          - /api/v1/auth
        methods:
          - GET
          - POST
          - OPTIONS
        strip_path: true
        preserve_host: false
        protocols:
          - http
          - https

  - name: donation-service
    protocol: http
    host: host.docker.internal
    port: 5002

    routes:
      - name: request-routes
        paths:
          - /api/v1/request
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - OPTIONS
        strip_path: true
        preserve_host: false
        protocols:
          - http
          - https
    plugins:
      - name: custom_authenticate
        config:
          validation_endpoint: "http://host.docker.internal:5005/verify-token"

  - name: user-service
    protocol: http
    host: host.docker.internal
    port: 5003

    routes:
      - name: user-routes
        paths:
          - /api/v1/user
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - OPTIONS
        strip_path: true
        preserve_host: false
        protocols:
          - http
          - https
    plugins:
      - name: custom_authenticate
        config:
          validation_endpoint: "http://host.docker.internal:5005/verify-token"

  - name: notification-service
    protocol: http
    host: host.docker.internal
    port: 5004

    routes:
      - name: notification-routes
        paths:
          - /api/v1/notification
        methods:
          - GET
          - PUT
          - OPTIONS
        strip_path: true
        preserve_host: false
        protocols:
          - http
          - https
    plugins:
      - name: custom_authenticate
        config:
          validation_endpoint: "http://host.docker.internal:5005/verify-token"

plugins:
  - name: rate-limiting
    config:
      minute: 60
      hour: 3600
      policy: local
      fault_tolerant: true

  # - name: cors
  #   config:
  #     origins:
  #       - *
  #     methods:
  #       - GET
  #       - POST
  #       - PUT
  #       - DELETE
  #       - OPTIONS
  #     headers:
  #       - Accept
  #       - Authorization
  #       - Content-Type
  #       - Origin
  #       - X-Requested-With
  #     exposed_headers:
  #       - Authorization
  #     credentials: true
  #     max_age: 3600
  #     preflight_continue: false

  - name: response-transformer
    config:
      add:
        headers:
          - X-Powered-By:Kong
      remove:
        headers:
          - Server
